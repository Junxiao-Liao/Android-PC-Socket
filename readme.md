# Android与PC通过USB通信

## 1. 技术选择

### 1.1使用Socket实现通信

> 为什么可以通过USB线实现Socket通信:
> 
> USB线为PC和Android手机提供了物理层的数据传输通道。adb可以利用这个通道在两端创建网络端口并实现数据的转发。
> 
> 具体来说,adb forward命令在PC端映射端口8000,在手机端映射端口9000。PC端8000端口收到的数据会通过USB线传输给手机端。
> 
> 此时从网络协议的视角来看,PC端的8000端口对手机的9000端口提供了一条TCP连接。
> 
> 那么应用层的Socket接口可以通过这个TCP连接发送和接收数据,不关心底层是通过USB还是WiFi或者其他网络。
> 
> 而输入/输出流则通过Socket读取和写入不同端口之间转发的数据。
> 
> 总的来说,是由adb利用USB线在两端建立了TCP端口映射和数据转发功能。应用层代码基于TCP协议的Socket接口,依赖于这种转发与对端通信。

### 1.2 没有使用`android.hardware.usb`库的原因:

- 该库主要用于Android与USB外设通信
- 尝试过几个开源库,无法直接读取PC端的USB端口数据

#### 2. 使用技术

### 2.1 PC端

- Java语言
  - Socket类:基于TCP协议的网络编程接口,用于连接adb转发的数据
- adb命令 **(需要先在环境变量中配置adb路径)**
  - adb forward: 在PC和手机之间通过USB线建立8000和9000端口的数据转发通道

### 2.2 Android端

- Java语言
  - Socket类:封装了基于TCP协议的网络编程接口,通过USB线转发与PC端通信
- 并发编程
  - 子线程:接收PC端的数据,避免阻塞UI线程

## 3. 运行和使用

### 3.1 PC端

1. 执行`adb forward tcp:8000 tcp:9000`在PC端8000端口与手机9000端口之间建立转发

2. 运行PcClient程序,连接到8000端口

3. 通过Socket的输出流发送数据到8000端口

4. Socket的输入流接收从9000端口转发的数据

### 3.2 Android端

1. 主线程连接到本地9000端口,准备接收数据

2. 子线程通过Socket不断读取输入流的数据

3. 主线程通过Socket得到的输出流发送输入框的数据

4. TextView更新显示收到的数据
